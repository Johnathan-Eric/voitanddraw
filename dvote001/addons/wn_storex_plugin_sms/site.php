<?php
 defined('IN_IA') or die('Access Denied'); class Wn_storex_plugin_smsModuleSite extends WeModuleSite { public function doWebSmsset() { goto KvU_G; VV6rc: $sms_info = pdo_get('storex_plugin_smsset', array('uniacid' => $_W['uniacid'])); goto L_aIr; uKsGK: message(error(-1, '请完整填写信息'), '', 'ajax'); goto jTLKo; fGLAb: $sms_post = $_GPC['params']; goto b_pdO; unAvW: OQZY_: goto bX4_V; D68l2: gdEnp: goto ONK6c; BWOfV: if ($j7K3V) { goto WWg24; } goto X2VNh; p91TM: WWg24: goto unAvW; tpl5h: pdo_update('storex_plugin_smsset', $sms_post, array('id' => $sms_info['id'])); goto D68l2; TUAtX: RxKZ2: goto tpl5h; bX4_V: $z2pel = !($op == 'post'); goto hftll; iGRP5: $op = in_array(trim($_GPC['op']), $ops) ? trim($_GPC['op']) : 'display'; goto RLXFJ; RLXFJ: $C2dAk = !($op == 'display'); goto eGuB2; ONK6c: message(error(0, '设置成功'), '', 'ajax'); goto Y1Cfr; MdNMW: $sms_info = pdo_get('storex_plugin_smsset', array('uniacid' => $_W['uniacid']), array('id')); goto mgUT4; X2VNh: $sms_info['status'] = 1; goto p91TM; mgUT4: if (!empty($sms_info)) { goto RxKZ2; } goto aWmnB; hftll: if ($z2pel) { goto keDfh; } goto kTDth; KvU_G: global $_W, $_GPC; goto XUj9M; XceZV: keDfh: goto g5k4N; kTDth: $e0l_R = !($_W['ispost'] && $_W['isajax']); goto AkYjl; Oek3y: pdo_insert('storex_plugin_smsset', $sms_post); goto IfGtq; aWmnB: $sms_post['uniacid'] = $_W['uniacid']; goto Oek3y; AkYjl: if ($e0l_R) { goto JEa9L; } goto fGLAb; jTLKo: KO4lD: goto MdNMW; uqFH4: if ($w4nOA) { goto KO4lD; } goto uKsGK; IfGtq: goto gdEnp; goto TUAtX; b_pdO: $w4nOA = !(empty($sms_post['appkey']) || empty($sms_post['appsecret']) || empty($sms_post['sign'])); goto uqFH4; L_aIr: $j7K3V = !empty($sms_info); goto BWOfV; eGuB2: if ($C2dAk) { goto OQZY_; } goto VV6rc; XUj9M: $ops = array('post', 'display'); goto iGRP5; Y1Cfr: JEa9L: goto XceZV; g5k4N: include $this->template("\163\155\x73\x73\x65\164"); goto YOuOx; YOuOx: } public function doWebSmsnotice() { goto lmGu4; w3nkG: $z2pel = !($op == 'post'); goto n5NiS; eQfpk: $MCMJH = !(!empty($sms_logs) && is_array($sms_logs)); goto XQwIo; EMD_r: $sms_logs = pdo_fetchall('SELECT * FROM ' . tablename('storex_plugin_sms_logs') . $condition . ' ORDER BY time DESC LIMIT ' . ($pindex - 1) * $psize . ',' . $psize, $params); goto Hwpc5; nTuO4: $sms_notice = pdo_get('storex_plugin_smsnotice', array('uniacid' => $_W['uniacid']), array('id')); goto UqOvZ; n5NiS: if ($z2pel) { goto QLA66; } goto HRnzN; sS0Db: $sms_notice = pdo_get('storex_plugin_smsnotice', array('uniacid' => $_W['uniacid'])); goto LD95L; HRnzN: $e0l_R = !($_W['ispost'] && $_W['isajax']); goto ok_C3; i5RRP: Ujdug: goto w3nkG; niU_M: QLA66: goto oURFy; MtPwJ: $params = array(':uniacid' => $_W['uniacid']); goto I8nwn; ok_C3: if ($e0l_R) { goto ROfe5; } goto kFCqi; Yxj5V: if ($U42nu) { goto bDEYl; } goto W9Srm; WS_d4: $sms_notice['notice']['user']['status'] = 1; goto Os8g8; HfdmA: bDEYl: goto nTuO4; Omdge: $pindex = max(1, intval($_GPC['page'])); goto Nmif_; w5C_6: if ($Sl0P2) { goto UzVgW; } goto L56vO; fVo_O: message(error(0, '设置成功'), '', 'ajax'); goto j1OxG; aLzP6: unset($value); goto eTpsB; Z1np1: if ($C2dAk) { goto Ujdug; } goto sS0Db; I8nwn: $condition = ' WHERE uniacid = :uniacid'; goto ynosj; apPvq: $pager = pagination($total, $pindex, $psize); goto eQfpk; b8ZA4: $U42nu = !(!empty($sms_post) && is_array($sms_post)); goto Yxj5V; eTpsB: dbaNp: goto qX_yT; xiISE: $params[':mobile'] = trim($_GPC['mobile']); goto lQvVB; kBcCt: $id = pdo_get('storex_plugin_sms_logs', array('id' => intval($_GPC['id']))); goto iuRhq; n8hBx: $C2dAk = !($op == 'display'); goto Z1np1; KkAAG: if ($LMl9W) { goto uZSoj; } goto xiISE; zbClz: $Sl0P2 = !empty($_GPC['id']); goto w5C_6; oURFy: $LIMIc = !($op == 'lists'); goto z3Xlk; UqOvZ: if (!empty($sms_notice)) { goto iXiZZ; } goto Mbkpz; Os8g8: hfJSG: goto i5RRP; z3Xlk: if ($LIMIc) { goto dbaNp; } goto Omdge; HBytU: eT6zW: goto cdyqH; XQwIo: if ($MCMJH) { goto X7Lij; } goto HIuoA; L56vO: itoast('参数错误', '', 'error'); goto QfR7D; oyjN9: uZSoj: goto EMD_r; d7B_H: $G3j41 = !empty($sms_notice['notice']); goto lk70t; epQDx: $op = in_array(trim($_GPC['op']), $ops) ? trim($_GPC['op']) : 'display'; goto n8hBx; gVkdw: $ops = array('post', 'display', 'lists', 'log_delete'); goto epQDx; cdyqH: X7Lij: goto aLzP6; AI9C1: if ($MuOMz) { goto BZK5a; } goto zbClz; Nmif_: $psize = 10; goto MtPwJ; MPrV0: jUpjh: goto HfdmA; lk70t: if ($G3j41) { goto hfJSG; } goto bIncW; Y_EaW: JuE9S: goto fVo_O; Mbkpz: pdo_insert('storex_plugin_smsnotice', array('notice' => iserializer($sms_post), 'uniacid' => $_W['uniacid'])); goto f1bWI; kFCqi: $sms_post = $_GPC['params']; goto b8ZA4; hWOnW: iXiZZ: goto rvQ2v; bIncW: $sms_notice['notice']['clerk']['status'] = 1; goto WS_d4; QfR7D: UzVgW: goto kBcCt; iuRhq: BZK5a: goto YEIcl; f1bWI: goto JuE9S; goto hWOnW; lmGu4: global $_W, $_GPC; goto gVkdw; lQvVB: $condition .= ' AND mobile = :mobile'; goto oyjN9; rvQ2v: pdo_update('storex_plugin_smsnotice', array('notice' => iserializer($sms_post)), array('id' => $sms_notice['id'])); goto Y_EaW; HIuoA: foreach ($sms_logs as &$value) { goto Ad66z; gcjeS: f4hpH: goto Vglg3; H_M6G: q_xir: goto gcjeS; nWzMz: $value['message'] = '发送成功'; goto H_M6G; Ad66z: $NwELH = !($value['status'] == 2 && empty($value['message'])); goto eRqqd; eRqqd: if ($NwELH) { goto q_xir; } goto nWzMz; Vglg3: } goto HBytU; Hwpc5: $total = pdo_fetchcolumn('SELECT COUNT(*) FROM ' . tablename('storex_plugin_sms_logs') . $condition, $params); goto apPvq; qX_yT: $MuOMz = !($op == 'log_delete'); goto AI9C1; j1OxG: ROfe5: goto niU_M; W9Srm: foreach ($sms_post as $key => $value) { goto udUly; rBKTf: KPfK6: goto SaDe1; xOg_v: if ($HOM_0) { goto sUST1; } goto UghYi; UghYi: message(error(-1, '请完整填写信息'), '', 'ajax'); goto Qcn33; udUly: $HOM_0 = !(empty($value['sms_template_code']) || empty($value['status'])); goto xOg_v; Qcn33: sUST1: goto rBKTf; SaDe1: } goto MPrV0; ynosj: $LMl9W = empty($_GPC['mobile']); goto KkAAG; YEIcl: include $this->template("\x73\x6d\x73\156\157\x74\x69\143\x65"); goto tOSjg; LD95L: $sms_notice['notice'] = iunserializer($sms_notice['notice']); goto d7B_H; tOSjg: } } ?>